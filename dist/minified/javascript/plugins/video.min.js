!function(e){e.Editable.DEFAULTS=e.extend(e.Editable.DEFAULTS,{videoAllowedAttrs:["src","width","height","frameborder","allowfullscreen","webkitallowfullscreen","mozallowfullscreen","href","target","id","controls","value","name"],videoAllowedTags:["iframe","object","param","video","source","embed"],defaultVideoAlignment:"center",textNearVideo:!0}),e.Editable.VIDEO_PROVIDERS=[{test_regex:/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#\&\?]*).*/,url_regex:/(?:https?:\/\/)?(?:www\.)?(?:m\.)?(?:youtube\.com|youtu\.be)\/(?:watch\?v=|embed\/)?(.+)/g,url_text:"//www.youtube.com/embed/$1",html:'<iframe width="640" height="360" src="{url}" frameborder="0" allowfullscreen></iframe>'},{test_regex:/^.*(vimeo\.com\/)((channels\/[A-z]+\/)|(groups\/[A-z]+\/videos\/))?([0-9]+)/,url_regex:/(?:https?:\/\/)?(?:www\.)?(?:vimeo\.com)\/(?:channels\/[A-z]+\/|groups\/[A-z]+\/videos\/)?(.+)/g,url_text:"//player.vimeo.com/video/$1",html:'<iframe width="640" height="360" src="{url}" frameborder="0" allowfullscreen></iframe>'},{test_regex:/^.+(dailymotion.com|dai.ly)\/(video|hub)?\/?([^_]+)[^#]*(#video=([^_&]+))?/,url_regex:/(?:https?:\/\/)?(?:www\.)?(?:dailymotion\.com|dai\.ly)\/(?:video|hub)?\/?(.+)/g,url_text:"//www.dailymotion.com/embed/video/$1",html:'<iframe width="640" height="360" src="{url}" frameborder="0" allowfullscreen></iframe>'},{test_regex:/^.+(screen.yahoo.com)\/(videos-for-you|popular)?\/[^_&]+/,url_regex:"",url_text:"",html:'<iframe width="640" height="360" src="{url}?format=embed" frameborder="0" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true" allowtransparency="true"></iframe>'}],e.Editable.video_commands={floatVideoLeft:{title:"Float Left",icon:{type:"font",value:"fa fa-align-left"}},floatVideoNone:{title:"Float None",icon:{type:"font",value:"fa fa-align-justify"}},floatVideoRight:{title:"Float Right",icon:{type:"font",value:"fa fa-align-right"}},removeVideo:{title:"Remove Video",icon:{type:"font",value:"fa fa-trash-o"}}},e.Editable.DEFAULTS=e.extend(e.Editable.DEFAULTS,{videoButtons:["floatVideoLeft","floatVideoNone","floatVideoRight","removeVideo"]}),e.Editable.commands=e.extend(e.Editable.commands,{insertVideo:{title:"Insert Video",icon:"fa fa-video-camera",callback:function(){this.insertVideo()},undo:!1}}),e.Editable.prototype.insertVideo=function(){this.options.inlineMode||(this.closeImageMode(),this.imageMode=!1,this.positionPopup("insertVideo")),this.selectionInEditor()&&this.saveSelection(),this.showInsertVideo(),this.$video_wrapper.find("textarea").val("")},e.Editable.prototype.insertVideoHTML=function(){var e='<div class="froala-popup froala-video-popup" style="display: none;"><h4><span data-text="true">Insert Video</span><i title="Cancel" class="fa fa-times" id="f-video-close-'+this._id+'"></i></h4><div class="f-popup-line"><textarea placeholder="Embedded code" id="f-video-textarea-'+this._id+'"></textarea></div><p class="or"><span data-text="true">or</span></p><div class="f-popup-line"><input type="text" placeholder="http://youku.com/" id="f-video-input-'+this._id+'"/><button data-text="true" class="f-ok f-submit fr-p-bttn" id="f-video-ok-'+this._id+'">OK</button></div></div>';return e},e.Editable.prototype.buildInsertVideo=function(){this.$video_wrapper=e(this.insertVideoHTML()),this.$popup_editor.append(this.$video_wrapper),this.addListener("hidePopups",this.hideVideoWrapper),this.$video_wrapper.on("mouseup touchend",e.proxy(function(e){this.isResizing()||e.stopPropagation()},this)),this.$video_wrapper.on("mouseup keydown","input#f-video-input-"+this._id+", textarea#f-video-textarea-"+this._id,e.proxy(function(e){e.stopPropagation()},this));var t=this;this.$video_wrapper.on("change","input#f-video-input-"+this._id+", textarea#f-video-textarea-"+this._id,function(){"INPUT"==this.tagName?t.$video_wrapper.find("textarea#f-video-textarea-"+t._id).val(""):"TEXTAREA"==this.tagName&&t.$video_wrapper.find("input#f-video-input-"+t._id).val("")}),this.$video_wrapper.on("click","button#f-video-ok-"+this._id,e.proxy(function(){var e=this.$video_wrapper.find("input#f-video-input-"+this._id),t=this.$video_wrapper.find("textarea#f-video-textarea-"+this._id);""!==e.val()?this.writeVideo(e.val(),!1):""!==t.val()&&this.writeVideo(t.val(),!0)},this)),this.$video_wrapper.on(this.mouseup,"i#f-video-close-"+this._id,e.proxy(function(){this.$bttn_wrapper.show(),this.hideVideoWrapper(),this.options.inlineMode&&!this.imageMode&&0===this.options.buttons.length&&this.hide(),this.restoreSelection(),this.focus(),this.options.inlineMode||this.hide()},this)),this.$video_wrapper.on("click",function(e){e.stopPropagation()}),this.$video_wrapper.on("click","*",function(e){e.stopPropagation()}),this.$window.on("keydown."+this._id,e.proxy(function(t){if(this.$element.find(".f-video-editor.active").length>0){var i=t.which;if(46==i||8==i)return t.stopPropagation(),t.preventDefault(),setTimeout(e.proxy(function(){this.removeVideo()},this),0),!1}},this))},e.Editable.prototype.destroyVideo=function(){this.$video_wrapper.html("").removeData().remove()},e.Editable.prototype.initVideo=function(){this.buildInsertVideo(),this.addVideoControls(),this.addListener("destroy",this.destroyVideo)},e.Editable.initializers.push(e.Editable.prototype.initVideo),e.Editable.prototype.hideVideoEditorPopup=function(){this.$video_editor&&(this.$video_editor.hide(),e("span.f-video-editor").removeClass("active"),this.$element.removeClass("f-non-selectable"),this.editableDisabled||this.isHTML||this.$element.attr("contenteditable",!0))},e.Editable.prototype.showVideoEditorPopup=function(){this.hidePopups(),this.$video_editor&&this.$video_editor.show(),this.$element.removeAttr("contenteditable")},e.Editable.prototype.addVideoControlsHTML=function(){this.$video_editor=e('<div class="froala-popup froala-video-editor-popup" style="display: none">');for(var t=e('<div class="f-popup-line">').appendTo(this.$video_editor),i=0;i<this.options.videoButtons.length;i++){var o=this.options.videoButtons[i];if(void 0!==e.Editable.video_commands[o]){var d=e.Editable.video_commands[o],r='<button class="fr-bttn" data-callback="'+o+'" data-cmd="'+o+'" title="'+d.title+'">';r+=void 0!==this.options.icons[o]?this.prepareIcon(this.options.icons[o],d.title):this.prepareIcon(d.icon,d.title),r+="</button>",t.append(r)}}this.addListener("hidePopups",this.hideVideoEditorPopup),this.$popup_editor.append(this.$video_editor),this.bindCommandEvents(this.$video_editor)},e.Editable.prototype.floatVideoLeft=function(){e("span.f-video-editor.active").attr("class","f-video-editor active fr-fvl"),this.triggerEvent("videoFloatedLeft"),e("span.f-video-editor.active").click()},e.Editable.prototype.floatVideoRight=function(){e("span.f-video-editor.active").attr("class","f-video-editor active fr-fvr"),this.triggerEvent("videoFloatedRight"),e("span.f-video-editor.active").click()},e.Editable.prototype.floatVideoNone=function(){e("span.f-video-editor.active").attr("class","f-video-editor active fr-fvn"),this.triggerEvent("videoFloatedNone"),e("span.f-video-editor.active").click()},e.Editable.prototype.removeVideo=function(){e("span.f-video-editor.active").remove(),this.hide(),this.triggerEvent("videoRemoved"),this.focus()},e.Editable.prototype.refreshVideo=function(){this.$element.find("iframe, object").each(function(t,i){for(var o=e(i),d=0;d<e.Editable.VIDEO_PROVIDERS.length;d++){var r=e.Editable.VIDEO_PROVIDERS[d];if(r.test_regex.test(o.attr("src"))){0===o.parents(".f-video-editor").length&&o.wrap('<span class="f-video-editor fr-fvn" data-fr-verified="true" contenteditable="false">');break}}}),this.browser.msie&&this.$element.find(".f-video-editor").each(function(){this.oncontrolselect=function(){return!1}}),this.options.textNearVideo||this.$element.find(".f-video-editor").attr("contenteditable",!1).addClass("fr-tnv")},e.Editable.prototype.addVideoControls=function(){this.addVideoControlsHTML(),this.addListener("sync",this.refreshVideo),this.$element.on("mousedown","span.f-video-editor",e.proxy(function(e){e.stopPropagation()},this)),this.$element.on("click touchend","span.f-video-editor",e.proxy(function(t){if(this.isDisabled)return!1;t.preventDefault(),t.stopPropagation();var i=t.currentTarget;this.clearSelection(),this.showVideoEditorPopup(),this.showByCoordinates(e(i).offset().left+e(i).width()/2,e(i).offset().top+e(i).height()+3),e(i).addClass("active"),this.refreshVideoButtons(i)},this))},e.Editable.prototype.refreshVideoButtons=function(t){var i=e(t).attr("class");this.$video_editor.find("[data-cmd]").removeClass("active"),i.indexOf("fr-fvl")>=0?this.$video_editor.find('[data-cmd="floatVideoLeft"]').addClass("active"):i.indexOf("fr-fvr")>=0?this.$video_editor.find('[data-cmd="floatVideoRight"]').addClass("active"):this.$video_editor.find('[data-cmd="floatVideoNone"]').addClass("active")},e.Editable.prototype.writeVideo=function(t,i){var o=null;if(i)o=this.clean(t,!0,!1,this.options.videoAllowedTags,this.options.videoAllowedAttrs);else for(var d=0;d<e.Editable.VIDEO_PROVIDERS.length;d++){var r=e.Editable.VIDEO_PROVIDERS[d];if(r.test_regex.test(t)){t=t.replace(r.url_regex,r.url_text),o=r.html.replace(/\{url\}/,t);break}}if(o){this.restoreSelection(),this.$element.focus();var a="fr-fvn";"left"==this.options.defaultVideoAlignment&&(a="fr-fvl"),"right"==this.options.defaultVideoAlignment&&(a="fr-fvr"),this.textNearVideo||(a+=" fr-tnv");try{this.insertHTML('<span contenteditable="false" class="f-video-editor '+a+'" data-fr-verified="true">'+o+"</span>")}catch(s){}this.$bttn_wrapper.show(),this.hideVideoWrapper(),this.hide(),this.triggerEvent("videoInserted",[o])}else this.triggerEvent("videoError")},e.Editable.prototype.showVideoWrapper=function(){this.$video_wrapper&&(this.$video_wrapper.show(),this.$video_wrapper.find(".f-popup-line input").val(""))},e.Editable.prototype.hideVideoWrapper=function(){this.$video_wrapper&&(this.$video_wrapper.hide(),this.$video_wrapper.find("input").blur())},e.Editable.prototype.showInsertVideo=function(){this.hidePopups(),this.showVideoWrapper()}}(jQuery);
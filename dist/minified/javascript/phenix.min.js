var phenix={visitor:{},url:{},redirect:function(e,t){setTimeout(function(){window.location=e},t)},show_error_note:function(e,t){e='<div class="content">'+e+"</div>",phenix.show_notify_bar(e,"error",t)},show_ok_note:function(e,t){e='<div class="content">'+e+"</div>",phenix.show_notify_bar(e,"ok",t)},show_notify_bar:function(e,t,i){var o;t&&"ok"!=t?(t="error",o="error"):(t="ok",o="success"),$.gritter.add({title:"",text:e,time:i,class_name:o}),$("#gritter-notice-wrapper").css({"z-index":1e3})}};phenix.show_error_message=function(e,t){var i='<ul class="list">';$.isArray(e)?$.each(e,function(e,t){i+="<li>"+t+"</li>"}):i+="<li>"+e+"</li>",i+="</ul>",$("<div/>").addClass("ui danger message").html(i).prependTo(t)},phenix.show_ok_message=function(e,t){alert(e)},phenix.before_submit=function(){return $(".ui.submit.button").addClass("loading").addClass("submit_back").removeClass("submit"),$(".ui.error.message").remove(),!0},phenix.after_submit=function(){return $(".ui.submit_back.button").removeClass("loading").removeClass("submit_back").addClass("submit"),!0},phenix.initial=function(){$.ajaxSetup({cache:!1}),$("a.confirm-request").livequery(function(){$(this).click(function(){return confirm("确认执行这个操作吗?")&&$.get($(this).attr("href")),!1})}),$("a.ajax").livequery(function(){$(this).click(function(){var e=$(this).attr("href");return phenix.visitor.is_login?($.get(e),!1):(phenix.show_login_box(e),!1)})}),$(".ui.message .close").livequery(function(){$(this).on("click",function(){$(this).closest(".ui.message").fadeOut("slow").css("z-index","-1")})}),$(".ui.basket.button").livequery(function(){$(this).on("click",function(){var e=$(this).data("url");phenix.redirect(e)})}),$("#shopping-basket .ui.close.button").livequery(function(){$(this).bind("click",function(){var e=$(this).data("sku");return $.get(phenix.url.domain+"/shopping/remove",{sku:e}),!1})}),$("#searchbar i.search.icon").click(function(){$("#searchbar").submit()}),$(".ui.cancel.button").bind("click",function(){window.location.href=document.referrer}),$(".ui.pop").popup(),$(".ui.checkbox").checkbox(),$(".ui.selection.dropdown").dropdown(),$(".ui.dropdown").dropdown({on:"hover"}),$(".ui.wechat.button").click(function(){return $(".ui.wechat.modal").modal("show"),!1}),$(".ui.accordion").accordion(),$.scrollUp({scrollText:'<i class="angle up icon"></i>',className:"ui topup icon scrollright",scrollTitle:!1}),phenix.showbox(),$(".promo .close-promo").click(function(){return $(".promo").slideUp("slow"),!1}),$("textarea.comment-textarea").maxlength({feedback:".wordscount"}),phenix.show_user_idcard()},phenix.show_login_box=function(e){$("#loginbox-form").form({account:{identifier:"account",rules:[{type:"empty",prompt:"输入你注册时填写的邮件或手机号码"}]},password:{identifier:"password",rules:[{type:"empty",prompt:"输入正确的登录密码"},{type:"length[6]",prompt:"登录密码为必须6位以上字符"}]}},{inline:!0,onSuccess:function(t){t.preventDefault(),$(this).ajaxSubmit({dataType:"json",beforeSubmit:function(){phenix.before_submit()},success:function(i){phenix.after_submit(),i.is_error?($(t.target).addClass("error"),phenix.show_error_note(i.message)):($(".ui.loginbox.modal").modal("hide"),phenix.visitor=i.data,e&&$.get(e))}})}}),$(".ui.loginbox.modal").modal("show")},phenix.wap_show_sign_box=function(e,t){$(".two.fields .field").tab(),$(".two.fields .field .fluid").tab(),$("#login-form").form({account:{identifier:"account",rules:[{type:"empty",prompt:"输入你注册时填写的手机号码"}]},password:{identifier:"password",rules:[{type:"empty",prompt:"输入正确的登录密码"},{type:"length[6]",prompt:"登录密码为必须6位以上字符"}]}},{inline:!0,onSuccess:function(i){i.preventDefault(),$(this).ajaxSubmit({dataType:"json",beforeSubmit:function(){phenix.before_submit()},success:function(o){phenix.after_submit(),o.is_error?($(i.target).addClass("error"),phenix.show_error_note(o.message)):($(".ui.sign-box.modal").modal("hide"),phenix.visitor=o.data,e&&(1==t?phenix.redirect(e):2==t&&$.get(e)))}})}}),$("#register-form").form({account:{identifier:"account",rules:[{type:"empty",prompt:"手机号不能为空"}]},verify_code:{identifier:"verify_code",rules:[{type:"empty",prompt:"验证码不能为空"}]}},{inline:!0,onSuccess:function(i){i.preventDefault(),$(i.target).ajaxSubmit({dataType:"json",beforeSubmit:function(){phenix.before_submit()},success:function(o){phenix.after_submit(),o.is_error?($(i.target).addClass("error"),phenix.show_error_note(o.message)):($(".ui.sign-box.modal").modal("hide"),phenix.visitor=o.data,alert("您的默认密码为当前手机号后6位,为了您的账户安全,请尽快去个人中心修改密码!"),e&&(1==t?phenix.redirect(e):2==t&&$.get(e)))}})}});var i=60,o=!0,n=function(){0==i?(o=!0,i=60,$("#fetch-verify-code").removeClass("active").text("获取验证码")):(o=!1,i--,$("#fetch-verify-code").addClass("active").text("重新发送("+i+")"),setTimeout(function(){n()},1e3))};$("#fetch-verify-code").click(function(){var e=$("#account").val();if(!o)return!1;if(e){var t="/app/site/auth/check_account";$.get(t,{phone:e},function(t){return 1==t?(phenix.show_error_note("手机号已存在！"),!1):(n(),$this=$("#fetch-verify-code"),$.getJSON("/app/site/auth/verify_code",{phone:e},function(e){200==e.errorCode&&$this.removeClass("disabled").text("获取验证码")}),void 0)})}else phenix.show_error_note("请正确填写手机号码！")})},phenix.showbox=function(){$(".showbox").livequery(function(){$(this).click(function(){var e=this.hash&&this.hash.substr(1);return $("#"+e).toggle(),!1})})},phenix.doit=function(e,t,i){var o,n=$("#"+e),r=n.html();"undefined"==typeof i&&(i=1),parseInt(r)==t&&(r=0),o=parseInt(r)+i,isNaN(o)&&(o=0),o<t?(n.html(o.toString()),setTimeout("phenix.doit('"+e+"',"+t+","+i+")",1)):n.html(t.toString())},phenix.build_auth_page=function(){$("#login-form").form({account:{identifier:"account",rules:[{type:"empty",prompt:"请输入您注册时填写的邮件或手机号码"}]},password:{identifier:"password",rules:[{type:"empty",prompt:"请输入正确的登录密码"},{type:"length[6]",prompt:"登录密码为必须6位以上字符"}]}},{inline:!0,onSuccess:function(e){e.preventDefault(),$(this).ajaxSubmit({dataType:"json",beforeSubmit:function(){phenix.before_submit()},success:function(e){phenix.after_submit(),e.is_error?phenix.show_error_note(e.message,5e3):phenix.redirect(e.redirect_url)}})}}),$("#register-form").form({account:{identifier:"account",rules:[{type:"empty",prompt:"账户名称不能为空"}]},verify_code:{identifier:"verify_code",rules:[{type:"empty",prompt:"验证码不能为空"}]},password:{identifier:"password",rules:[{type:"empty",prompt:"请输入正确的登录密码"},{type:"length[6]",prompt:"登录密码必须6位以上字符"}]},password_confirm:{identifier:"password_confirm",rules:[{type:"empty",prompt:"请输入正确的确认密码"},{type:"match[password]",prompt:"两次输入密码不一致"}]}},{inline:!0,onSuccess:function(e){e.preventDefault(),$(e.target).ajaxSubmit({dataType:"json",beforeSubmit:function(){phenix.before_submit()},success:function(e){phenix.after_submit(),e.is_error?phenix.show_error_note(e.message,5e3):phenix.redirect(e.redirect_url)}})}})},phenix.hook_product_topic=function(){$("#topic-form").form({title:{identifier:"title",rules:[{type:"empty",prompt:"标题不能为空"},{type:"maxLength[40]",prompt:"内容不超过40字符"}]},description:{identifier:"description",rules:[{type:"empty",prompt:"评论内容不能为空"},{type:"maxLength[140]",prompt:"评论内容不超过140字符"}]}},{inline:!0,onSuccess:function(e){e.preventDefault(),$(e.target).ajaxSubmit()}})},phenix.hook_comment_page=function(){var e=arguments[0]?arguments[0]:"site";$("#comment-form").form({fields:{content:{identifier:"content",rules:[{type:"empty",prompt:"评论内容不能为空"},{type:"length[5]",prompt:"评论内容不能少于5个字符"},{type:"maxLength[1000]",prompt:"评论内容不超过1000个字符"}]}},inline:!0,onSuccess:function(e){e.preventDefault(),$(this).ajaxSubmit({dataType:"json",beforeSubmit:function(){phenix.before_submit()},success:function(t){if(t.is_error)$(e.target).addClass("error"),phenix.show_error_note(t.message,e.target);else{var i=phenix.ajax_render_result("#get_single_comment_tpl",t.data);$(".ui.threaded.comments.is-comment").append(i),$(".comment-textarea").val(""),"site"==t.data.from_site?$(".ui.sticky").sticky("refresh"):t.data.rank_has_first_comment&&$("#mask").css("display","");var o=$(":input[name=is_reply]").val();if(1==o){$(":input[name=reply_id]").val(""),$(":input[name=is_reply]").val(0),$(":input[name=reply_user_id]").val("");var n=$(".cancel-reply-btn").attr("recover_comment_user_href"),r=$(".cancel-reply-btn").attr("recover_comment_user_name"),a='<a href="'+n+'" class="ui magenta link">'+r+"</a> 发表评论";$("#comment-box").find(".comment-title").html(a)}}phenix.after_submit()}})}}),$(".gotofloor").bind("keydown",function(e){var t=$(this).val(),i=parseInt($(this).data("max")),o=$(this).data("url");if(13==e.keyCode){if(isNaN(t))return alert("必须输入一个数字！"),!1;t>i&&(t=i),window.location.href=o+"/"+t+"#f"+t}}),"site"==e&&$("#comment-area").atwho({at:"@",data:"/app/site/user/ajax_follow_list",limit:50,insertTpl:"@${name}",callbacks:{afterMatchFailed:function(e,t){if("@"==e)return tags.push(t.text().trim().slice(1)),this.model.save(tags),this.insert(t.text().trim()),!1}}})},phenix.rebuild_batch_assets=function(e){var t=$("#batch_assets").val();if(t){var i=t.split(",");$.inArray(e,i)==-1&&(i.push(e),$("#batch_assets").val(i.join(",")))}else $("#batch_assets").val(e)},phenix.ajax_render_result=function(e,t){var i=$(e).html(),o=Mustache.render(i,t);return o},phenix.show_user_idcard=function(){var e,t,i=!1;$(".ui.idcard").each(function(o){$(this).hover(function(o){var n=$(this).data("uid"),r=($(this).position(),$(this).height(),$(this));clearTimeout(t),e=setTimeout(function(e){i||(0==r.children(".user_card_box").length?$.post(phenix.url.domain+"/user/ajax_fetch_profile",{id:n},function(e){i=!0,e.data.phenix=phenix.url;var t=phenix.ajax_render_result("#user_card_tpl",e.data);$('<div class="user_card_box"></div>').html(t).appendTo(r).show(function(){i=!1})},"json"):r.children(".user_card_box").show())},200)},function(i){var o=$(this);clearTimeout(e),t=setTimeout(function(){o.children(".user_card_box").hide()},100),$(".user_card_box").hover(function(e){clearTimeout(t)},function(e){o.children(".user_card_box").hide()})})})},phenix.signin=function(){$.ajax({type:"POST",url:"/user/ajax_fetch_user_sign",data:{type:1},dataType:"json",cache:!1,success:function(e){var t=phenix.ajax_render_result("#user_sign_box_tpl",e.data);$("#user-sign-box").html(t)}}),$("#sign-in-btn").livequery(function(){$(this).click(function(){return phenix.visitor.is_login?void $.ajax({type:"POST",url:"/user/ajax_sign_in",data:{type:1},dataType:"json",cache:!1,async:!1,success:function(e){1==e.data.give_money?e.data.give_money=!0:e.data.give_money=!1,1==e.data.is_true?e.data.is_true=!0:e.data.is_true=!1;var t=phenix.ajax_render_result("#user_sign_box_tpl",e.data);$("#user-sign-box").html(t),e.data.is_doing&&window.setTimeout(function(){$(".add").addClass("add-active")},500)}}):(phenix.show_login_box(),!1)})})},phenix.bind_share_list=function(e){var t=encodeURIComponent(document.location),i=encodeURIComponent(document.title.substring(0,100)),o=encodeURIComponent("太火鸟"),n="tShare",r="http://www.taihuoniao.com/",a=function(e,t){return["toolbar=0,status=0,resizable=1,width="+e+",height="+t+",left=",(screen.width-e)/2,",top=",(screen.height-t)/2].join("")};$("#wechat-share,#wechat-share-1").click(function(){return $(".ui.qrcode.modal").modal("show"),!1}),$("#sina-share,#sina-share-1").click(function(){var o="http://v.t.sina.com.cn/share/share.php?url="+t+"&title="+i+"&pic="+e,r=a(607,523);return window.open(o,n,r),!1}),$("#o-share-weibo").click(function(){var o="http://v.t.sina.com.cn/share/share.php?url="+t+"&title="+i+"&pic="+e,r=a(607,523);return window.open(o,n,r),!1}),$("#tencent-share,#tencent-share-1").click(function(){var o="http://v.t.qq.com/share/share.php?title="+i+"&url="+t+"&site="+r+"&pic="+e,s=a(634,668);return window.open(o,n,s),!1}),$("#douban-share").click(function(){var o="http://www.douban.com/recommend/?url="+t+"&title="+i+"&pic="+e,r=a(450,350);return window.open(o,n,r),!1}),$("#renren-share,#renren-share-1").click(function(){var o="http://share.renren.com/share/buttonshare?link="+t+"&title="+i+"&pic="+e,r=a(626,436);return window.open(o,n,r),!1}),$("#kaixin001-share").click(function(){var o="http://www.kaixin001.com/repaste/share.php?rurl="+t+"&rcontent="+t+"&rtitle="+i+"&pic="+e,r=a(540,342);return window.open(o,n,r),!1}),$("#netease-share").click(function(){var e="http://t.163.com/article/user/checkLogin.do?link="+t+"source="+o+"&info="+i+" "+t,r=a(642,468);return window.open(e,n,r),!1}),$("#facebook-share").click(function(){var e="http://facebook.com/share.php?u="+t+"&t="+i,o=a(626,436);return window.open(e,n,o),!1}),$("#twitter-share").click(function(){var e="http://twitter.com/share?url="+t+"&text="+i,o=a(500,375);return window.open(e,n,o),!1}),$("#delicious-share").click(function(){var e="http://delicious.com/post?url="+t+"&title="+i,o=a(550,550);return window.open(e,n,o),!1}),$("#qzone-share").click(function(){var o="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url="+t+"&title="+i+"&pic="+e,r=a(600,560);return window.open(o,n,r),!1})},phenix.create_cookie=function(e,t,i,o,n){var r="",a="";if(i){var s=new Date;s.setTime(s.getTime()+24*i*60*60*1e3),a="; expires="+s.toGMTString()}o=o?"; domain="+o:"",n="; path="+(n?n:"/"),document.cookie=e+"="+t+a+n+o+r},phenix.read_cookie=function(e){for(var t=e+"=",i=document.cookie.split(";"),o=0;o<i.length;o++){var n=i[o].replace(/^\s+/,"");if(0==n.indexOf(t))return n.substring(t.length)}return null},phenix.erase_cookie=function(e,t,i){create_cookie(e,"",-1,t,i)};var wps_width=0,wps_height=0,wps_ratio=1,scale_width=480,scale_height=0,crop_width=0,crop_height=0;phenix.preview=function(e,t){t.width&&t.height&&($("#x1").val(t.x1),$("#y1").val(t.y1),$("#x2").val(t.x2),$("#y2").val(t.y2),$("#w").val(t.width),$("#h").val(t.height))},phenix.record_asset_id=function(e,t){var i=$("#"+e).val();0==i.length?i=t:i.indexOf(t)==-1&&(i+=","+t),$("#"+e).val(i)},phenix.remove_asset_id=function(e,t){var i=$("#"+e).val(),o=i.split(","),n=phenix.in_array(o,t);o.splice(n,1),i=o.join(","),$("#"+e).val(i)},phenix.in_array=function(e,t){var i;for(i=0;i<e.length;i++)if(t===e[i])return i;return-1},phenix.fetch_comment=function(e){var t=void 0!=e.is_star?e.is_star:0;$.ajax({type:"GET",url:url,data:{target_id:e.target_id,type:e.type,page:e.page,per_page:e.per_page,sort:e.sort,is_star:t},dataType:"json",cache:!1,async:!1,success:function(e){e.data.phenix=phenix.url;var t=parseInt(e.data.result.total_page),i=parseInt(e.data.page);parseInt(e.data.per_page);1==i?e.data.page_first=!0:e.data.page_first=!1;var o=phenix.ajax_render_result("#get_comments_tpl",e.data);if($(".is-comment.comments").html(o),t>1){var n=phenix.ajax_render_result("#pager_tpl",e.data);$(".ui.pagerbox").html(n)}1==e.data.sort&&$(".ui.hotset.comments").remove(),phenix.comment_blow_up_img(),$(".ui.sticky").sticky("refresh"),phenix.scrollToHash()}})},phenix.scrollToHash=function(){var e=location.hash.substring(1),t=$("#"+e).first();if(t&&t.length){var i=t.offset().top-20,o=$(document.body);o.stop(!0,!1).animate({scrollTop:i},parseInt(750),jQuery.easing.linear)}},phenix.comment_blow_up_img=function(){$(".comment-img-box").find("img").on("click",function(){var e=$(this).parent(".comment-img-box").attr("show-type");1==e?($(this).css({"max-width":"100%",cursor:"-moz-zoom-out",cursor:"-ms-zoom-out",cursor:"-o-zoom-out",cursor:"-webkit-zoom-out"}),$(this).parent(".comment-img-box").attr("show-type",2)):($(this).css({"max-width":"150px",cursor:"-moz-zoom-in",cursor:"-ms-zoom-in",cursor:"-o-zoom-in",cursor:"-webkit-zoom-in"}),$(this).parent(".comment-img-box").attr("show-type",1))})},phenix.updateAreaSelect=function(){},jQuery.extend(jQuery.fn.pickadate.defaults,{monthsFull:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],monthsShort:["一","二","三","四","五","六","七","八","九","十","十一","十二"],weekdaysFull:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],weekdaysShort:["日","一","二","三","四","五","六"],today:"今天",clear:"清除",firstDay:1,format:"yyyy-mm-dd",formatSubmit:"yyyy-mm-dd"}),$("img.lazy").lazyload({effect:"fadeIn",threshold:-20}),$("a.bglazy").lazyload({effect:"fadeIn",threshold:-20}),$("div.bglazy").lazyload({effect:"fadeIn",threshold:-20}),$(".ui.wap a.launch").on("click",function(){$("#cover").css("display","block"),$("body").addClass("menu-open"),$("html").css("overflow","hidden")}),$(".ui.wap #cover").click(function(){$("#cover").css("display","none"),$("body").removeClass("menu-open"),$("html").removeAttr("style")});var ua=navigator.userAgent.toLowerCase();"micromessenger"==ua.match(/MicroMessenger/i)?$(".ui.small.wechat.mmfootewm.modal p").html("长按图片，点击识别图片中二维码，关注太火鸟公众号"):$(".ui.small.wechat.mmfootewm.modal p").html("保存图片，打开微信扫描二维码，关注太火鸟公众号"),$(".apploadclose").on("click",function(){$(".appiosload").remove()}),$("#appload,#apploadand").click(function(){$("#appload,#apploadand").removeAttr("style")}),navigator.userAgent.match(/(iPhone|iPod|iPad);?/i)?(window.setTimeout(function(){$(".appiosload").fadeIn(1e3)},2e3),$(".appiosload .magenta.inverted.button").click(function(){var e=navigator.userAgent.toLowerCase();"micromessenger"==e.match(/MicroMessenger/i)?window.location="http://a.app.qq.com/o/simple.jsp?pkgname=com.taihuoniao.fineix":window.location="https://itunes.apple.com/us/app/fiu-fu-you-ke-ji-mei-xue-qing/id1089442815?mt=8"})):navigator.userAgent.match(/android/i)&&(window.setTimeout(function(){$(".appiosload").fadeIn(1e3)},2e3),$(".appiosload .magenta.inverted.button").click(function(){var e=navigator.userAgent.toLowerCase();"micromessenger"==e.match(/MicroMessenger/i)?window.location="http://a.app.qq.com/o/simple.jsp?pkgname=com.taihuoniao.fineix":window.location="http://a.app.qq.com/o/simple.jsp?pkgname=com.taihuoniao.fineix"})),$(function(){0==phenix.read_cookie("closeload")?$(".appiosload").remove():window.setTimeout(function(){$(".appiosload").fadeIn(1e3)},2e3),$(".apploadclose").on("click",function(){phenix.create_cookie("closeload","0",{expires:1})})}),$(".header .close.icon").click(function(){$(".ui.modal").modal("hide")}),function(e){e.fn.extend({insertAtCaret:function(t){var i=e(this)[0];if(document.selection)this.focus(),sel=document.selection.createRange(),sel.text=t,this.focus();else if(i.selectionStart||"0"==i.selectionStart){var o=i.selectionStart,n=i.selectionEnd,r=i.scrollTop;i.value=i.value.substring(0,o)+t+i.value.substring(n,i.value.length),this.focus(),i.selectionStart=o+t.length,i.selectionEnd=o+t.length,i.scrollTop=r}else this.value+=t,this.focus()}})}(jQuery);